<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Entebbe Airport Chatbot</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="chat-container">
  <div id="chat-header">Entebbe Airport Chatbot</div>
  <div id="messages"></div>
  <div id="typing" style="display:none;">Bot is typing...</div>
  <div id="input-area">
    <input type="text" id="userInput" placeholder="Type your message..."/>
    <button id="sendBtn" onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const messagesDiv = document.getElementById('messages');
const userInput = document.getElementById('userInput');
const typingDiv = document.getElementById('typing');

// Use your deployed URL
const WEBHOOK_URL = 'https://entebbechatbot-1.onrender.com/webhook';

// Bubble color classes by intent
const intentClasses = {
    'Flight Status': 'flight-status',
    'Navigation': 'navigation',
    'Baggage Info': 'baggage-info',
    'Transport Info': 'transport-info'
};

// Append messages with emoji icons
function appendMessage(sender, text, intent='') {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message ' + sender;

    // Bubble color for bot
    if (sender === 'bot' && intent) msgDiv.classList.add(intentClasses[intent] || '');

    const iconSpan = document.createElement('span');
    iconSpan.style.fontSize = '18px';
    iconSpan.style.marginRight = '8px';

    if (sender === 'user') {
        iconSpan.textContent = '🧑';
        msgDiv.appendChild(document.createTextNode(text));
        msgDiv.appendChild(iconSpan);
    } else {
        switch(intent) {
            case 'Flight Status': iconSpan.textContent = '✈️'; break;
            case 'Navigation': iconSpan.textContent = '🏢'; break;
            case 'Baggage Info': iconSpan.textContent = '🧳'; break;
            case 'Transport Info': iconSpan.textContent = '🚕'; break;
            default: iconSpan.textContent = '🤖';
        }
        msgDiv.appendChild(iconSpan);
        msgDiv.appendChild(document.createTextNode(text));
    }

    messagesDiv.appendChild(msgDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Detect parameters
function getParameters(text) {
    const params = {};

    const flightRegex = /\b([A-Z]{2}\d{3,4})\b/;
    const match = text.toUpperCase().match(flightRegex);
    if (match) params['flight_number'] = match[1];

    const baggageWords = ['missing','lost','claim','carry','kg','weight'];
    if (baggageWords.some(word => text.toLowerCase().includes(word))) {
        params['baggage_issue'] = text;
    }

    const navWords = ['baggage','terminal','gate','lounge'];
    if (navWords.some(word => text.toLowerCase().includes(word))) {
        params['location'] = text;
    }

    const transportWords = ['taxi','bus','shuttle','city to airport','from city'];
    if (transportWords.some(word => text.toLowerCase().includes(word))) {
        params['transport_type'] = text;
    }

    return params;
}

function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;

    appendMessage('user', text);
    userInput.value = '';
    typingDiv.style.display = 'block';

    const params = getParameters(text);

    const payload = {
        queryResult: {
            queryText: text,
            parameters: params,
            intent: { displayName: '' }
        }
    };

    fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    })
    .then(response => response.json())
    .then(data => {
        typingDiv.style.display = 'none';
        const reply = data.fulfillmentText || "Sorry, I didn't understand that.";
        const intent = data.intent || '';
        appendMessage('bot', reply, intent);
    })
    .catch(err => {
        typingDiv.style.display = 'none';
        appendMessage('bot', 'Error connecting to chatbot.');
        console.error(err);
    });
}

userInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendMessage();
});
</script>

</body>
</html>
